#!/usr/bin/env bash

##############################################################################
#
# Global variables
#
##############################################################################
ME=`basename $0`

##CPKG_DIRS##
# CPKG BOOTSTRAP BEGIN
if [ -z "$LIBDIR" ]; then
    MYDIR=`dirname $0`
    MYDIR=`cd $MYDIR/.. && pwd`
    BINDIR=$MYDIR/bin
    ETCDIR=$MYDIR/etc
    LIBDIR=$MYDIR/lib
    SHAREDIR=$MYDIR/share
    VARDIR=$MYDIR/var
    LOGDIR=$MYDIR/log
fi
# CPKG BOOTSTRAP END

. $LIBDIR/libcbuild.sh

##############################################################################
#
# Main part
#
##############################################################################

OPTSPECS[A]="ADDRESS_SANITIZER::enable address sanitizer:0"
OPTSPECS[S]="NO_STACK_PROTECTOR::disable stack protector:0"
OPTSPECS[C]="NO_CCACHE::disable ccache:0"
OPTSPECS[N]="CB_NO_SCAN::don't scan sources:0"
OPTSPECS[O]="DONT_OPTIMIZE::disable optimizations:0"
OPTSPECS[c]="COVERAGE::enable coverage:0"
OPTSPECS[p]="PROFILING::enable profiling:0"

cp_get_options "$@"

# Check configuration was loaded
cp_ensure_file_exists $CBUILD_CONF
cp_ensure_dir_exists $PRJ_SRCDIR

PRJ_OPTS[sanitizer]=$ADDRESS_SANITIZER
[ $NO_STACK_PROTECTOR -eq 1 ] || PRJ_OPTS[stack_protector]=1
[ $NO_CCACHE -eq 1 ] || PRJ_OPTS[ccache]=1
[ $DONT_OPTIMIZE -eq 1 ] || PRJ_OPTS[optimize]=1
PRJ_OPTS[coverage]=$COVERAGE
PRJ_OPTS[profiling]=$PROFILING

export CB_NO_SCAN

cb_configure

##############################################################################
#
# POD Documentation
#
##############################################################################
: <<=cut
=pod

=head1 NAME

cbuild - C/C++ automated project configurator and builder

=head1 DESCRIPTION

cbuild is very nice.

=head1 SYNOPSIS

  cbuild

=cut
